<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>IP + Geolocalizaci贸n</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f7f7f7;
        }
        .box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }
        .map-link {
            display: inline-block;
            padding: 8px 12px;
            background: #1a73e8;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h2>Informaci贸n del Dispositivo p3 link mpas +exacta</h2>

<div class="box">
    <div><b>IP P煤blica:</b> <span id="publicIP">Obteniendo...</span></div>
</div>

<div class="box">
    <div><b>IP Local (LAN):</b> <span id="localIP">Obteniendo...</span></div>
</div>

<div class="box">
    <div id="gps"><b>GPS:</b> Obteniendo...</div>
    <div id="map"></div>
</div>

<br>

<script>
/* ==========================================================
   1. OBTENER IP PBLICA
   ========================================================== */
async function obtenerIPP煤blica() {
    try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        document.getElementById("publicIP").innerText = data.ip;
    } catch (e) {
        document.getElementById("publicIP").innerText = "Error";
    }
}
obtenerIPP煤blica();

/* ==========================================================
   2. OBTENER IP LOCAL (LAN) USANDO WebRTC
   ========================================================== */
function obtenerIPLocal() {
    let pc = new RTCPeerConnection({iceServers: []});
    pc.createDataChannel("");
    pc.createOffer()
        .then(o => pc.setLocalDescription(o))
        .catch(err => console.error(err));

    pc.onicecandidate = (event) => {
        if (!event || !event.candidate) return;

        let ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
        let ipMatch = ipRegex.exec(event.candidate.candidate);

        if (ipMatch) {
            document.getElementById("localIP").innerText = ipMatch[1];
            pc.close();
        }
    };
}
obtenerIPLocal();

/* ==========================================================
   3. OBTENER COORDENADAS GPS (ALTA PRECISIN)
   ========================================================== */
function obtenerGPS() {
    if (!navigator.geolocation) {
        document.getElementById("gps").innerText = "GPS no soportado por este dispositivo.";
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const acc = pos.coords.accuracy; // precisi贸n en metros

            document.getElementById("gps").innerHTML =
                `<b>GPS:</b> Lat ${lat}, Lon ${lon}<br>Precisi贸n: ${acc} metros`;

            const url = `https://www.google.com/maps?q=${lat},${lon}`;
            document.getElementById("map").innerHTML =
                `<a class="map-link" href="${url}" target="_blank"> Ver en Google Maps</a>`;
        },
        (err) => {
            document.getElementById("gps").innerText = "Error GPS: " + err.message;
        },
        {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 20000
        }
    );
}
obtenerGPS();
</script>

</body>
</html>
